<!DOCTYPE html>
<html lang="fr" data-theme="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avis ‚Äì Camping de Rivassland</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --glass: rgba(255,255,255,.56);
      --glass-strong: rgba(255,255,255,.70);
      --primary:#2563eb; --primary-700:#1d4ed8;
      --text:#0f172a; --muted:#475569; --shadow:0 18px 46px rgba(2,6,23,.20);
      --radius:22px; --transition:200ms ease; --gold:#f59e0b;
    }
    html[data-theme="dark"]{
      --glass: rgba(17,24,39,.46);
      --glass-strong: rgba(17,24,39,.62);
      --primary:#60a5fa; --primary-700:#3b82f6;
      --text:#e5e7eb; --muted:#94a3b8; --shadow:0 22px 56px rgba(0,0,0,.46);
    }
    @media (prefers-reduced-motion:no-preference){
      *{ transition: color var(--transition), background-color var(--transition), border-color var(--transition), transform var(--transition), box-shadow var(--transition); }
    }

    html,body{height:100%}
    body{margin:0; color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:#000}

    /* Fond simple: jour/nuit sans transition */
    .bg, .bg-night{ position:fixed; inset:0; z-index:-1; background-size:cover; background-position:center; background-repeat:no-repeat }
    .bg{ background-image:url("camping.jpg"); }
    .bg-night{ background-image:url("camping-nuit.jpg"); opacity:0; }
    html[data-theme="dark"] .bg{ opacity:0; }
    html[data-theme="dark"] .bg-night{ opacity:1; }

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:5;display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 18px;
      backdrop-filter: blur(10px) saturate(120%); background: color-mix(in oklab, rgba(0,0,0,.55) 55%, rgba(255,255,255,.28));
      border-bottom:1px solid rgba(255,255,255,.2)}
    .nav-left{display:flex;align-items:center;gap:16px}
    .logo{height:42px;border-radius:8px}
    .nav{display:flex;gap:10px;background: color-mix(in oklab, var(--glass) 84%, transparent); border:1px solid rgba(255,255,255,.45); padding:6px 10px; border-radius:999px}
    .nav a{ text-decoration:none; color:var(--text); font-weight:700; padding:6px 12px; border-radius:999px }
    .nav a[aria-current="page"], .nav a:hover{ background: rgba(255,255,255,.35) }
    .theme-toggle{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:9px 15px;color:#fff;font-weight:700;border:1px solid color-mix(in oklab,var(--primary) 35%,transparent);background:linear-gradient(180deg,var(--primary),var(--primary-700));cursor:pointer}

    /* Grille : align-items:start => hauteurs ind√©pendantes */
    .wrap{
      max-width:1100px; margin: clamp(14px,4vw,42px) auto; padding: clamp(12px,2.6vw,24px);
      display:grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start;
    }
    @media (max-width: 980px){ .wrap{ grid-template-columns:1fr } }

    .panel{
      background:var(--glass); backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255,255,255,.35); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: clamp(18px,3vw,28px);
      will-change: transform, box-shadow;
    }
    .panel:hover{ transform: translateY(-2px); }

    h1,h2{ font-family:Poppins,system-ui,sans-serif; margin:0 0 10px }
    label{display:flex;flex-direction:column;gap:6px;color:var(--muted);font-size:14px}
    input,select,textarea{ padding:12px 14px; border-radius:14px; border:1px solid rgba(15,23,42,.16); background:#fff }
    html[data-theme="dark"] input,html[data-theme="dark"] select,html[data-theme="dark"] textarea{ background:#0b1220; color:#e5e7eb; border-color: rgba(148,163,184,.28) }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px } @media(max-width:640px){ .row{ grid-template-columns:1fr } }
    button{ display:inline-flex; align-items:center; gap:8px; padding:12px 16px; border-radius:12px; border:1px solid color-mix(in oklab, var(--primary) 35%, transparent); background: linear-gradient(180deg, var(--primary), var(--primary-700)); color:#fff; font-weight:800; cursor:pointer }
    button:hover{ transform: translateY(-1px) scale(1.01); }
    .hint{ color:var(--muted); font-size:12px }

    /* Avis */
    .stars{ color: var(--gold); font-size:18px; letter-spacing:2px }
    .avis-item{ background: var(--glass-strong); border:1px solid rgba(255,255,255,.45); border-radius:16px; padding:14px; margin-top:12px }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="bg-night" aria-hidden="true"></div>

  <header class="topbar">
    <div class="nav-left">
      <img src="logo.jpg" alt="Camping Rivassland" class="logo">
      <nav class="nav">
        <a href="accueil.html">Accueil</a>
        <a href="reservation.html">R√©servations</a>
        <a href="index.html" aria-current="page">Donner votre avis</a>
      </nav>
    </div>
    <button id="themeToggle" class="theme-toggle"><span id="themeIcon">üåû</span><span id="themeLabel">Mode clair</span></button>
  </header>

  <main class="wrap">
    <!-- Colonne 1 : Formulaire (hauteur ind√©pendante) -->
    <section class="panel" id="panel-form">
      <h1>Votre avis nous aide üí¨</h1>
      <form id="form">
        <div class="row">
          <label>Nom<input id="nom" required></label>
          <label>Pr√©nom<input id="prenom" required></label>
        </div>
        <label>P√©riode du s√©jour <input id="periode" placeholder="ex. 12‚Äì15 ao√ªt 2025" required></label>

        <div class="row">
          <label>Note sur le lieu
            <select id="noteLieu" required>
              <option value="" disabled selected>Choisir‚Ä¶</option>
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
            <small class="hint">1 = m√©diocre, 5 = excellent</small>
          </label>
          <label>Note sur l‚Äôaccueil
            <select id="noteAccueil" required>
              <option value="" disabled selected>Choisir‚Ä¶</option>
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
          </label>
        </div>

        <label>Avis sur le lieu<textarea id="avisLieu" rows="3" placeholder="Ce que vous avez aim√©, pistes d‚Äôam√©lioration‚Ä¶" required></textarea></label>
        <label>Avis sur les h√¥tes<textarea id="avisHotes" rows="3" placeholder="Accueil, disponibilit√©, ambiance‚Ä¶" required></textarea></label>

        <label>T√©l√©phone (international)<input id="telephone" type="tel" placeholder="+33 6 12 34 56 78" required></label>
        <label>Que pourrions-nous am√©liorer ?<textarea id="ameliorations" rows="2" placeholder="Suggestions (facultatif)"></textarea></label>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button type="submit">Ajouter la r√©ponse</button>
          <span id="msg" class="hint"></span>
        </div>
      </form>
    </section>

    <!-- Colonne 2 : Avis (hauteur ind√©pendante) -->
    <section class="panel" id="panel-avis">
      <h2>Avis des visiteurs</h2>
      <div id="avisList"></div>
    </section>
  </main>

  <script>
    // Th√®me
    (function(){
      const html=document.documentElement, saved=localStorage.getItem("theme");
      html.setAttribute("data-theme",(saved==="light"||saved==="dark")?saved:(matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));
      const btn=document.getElementById("themeToggle"), icon=document.getElementById("themeIcon"), label=document.getElementById("themeLabel");
      function u(){ const d=html.getAttribute("data-theme")==="dark"; icon.textContent=d?"üåô":"üåû"; label.textContent=d?"Mode sombre":"Mode clair"; }
      btn.addEventListener("click",()=>{ const next=html.getAttribute("data-theme")==="dark"?"light":"dark"; html.setAttribute("data-theme",next); localStorage.setItem("theme",next); u(); });
      u();
    })();

    const API="/api/gas";
    const form=document.getElementById('form'), msg=document.getElementById('msg'), list=document.getElementById('avisList');

    function stars(n){ const s=Math.round(Number(n)||0); return '‚òÖ'.repeat(s)+'‚òÜ'.repeat(5-s); }

    async function load(){
      list.textContent="Chargement‚Ä¶";
      try{
        const r=await fetch(API); const data=await r.json();
        list.innerHTML="";
        if(!Array.isArray(data) || !data.length){ list.textContent="Pas encore d‚Äôavis. Soyez le premier !"; return; }
        data.forEach(row=>{
          const nom=row.nom||row.Nom||""; const prenom=row.prenom||row.Pr√©nom||row.Prenom||"";
          const avisLieu=row.avisLieu||row["Avis sur le lieu"]||row.avis_lieu||"";
          const avisH=row.avisHotes||row["Avis sur les hotes"]||row["Avis sur les h√¥tes"]||row.avis_hotes||"";
          const noteL=Number(row.noteLieu||row["Note lieu"]||row.note_lieu||0);
          const noteA=Number(row.noteAccueil||row["Note accueil"]||row.note_accueil||0);
          const date=row.horodatage||row.date||row.timestamp||"";
          const moyenne = (noteL+noteA)/2 || 0;

          const el=document.createElement('div'); el.className='avis-item';
          el.innerHTML=`
            <div class="stars" title="Note globale">${stars(moyenne)}</div>
            <div style="font-weight:700; margin-top:6px">${nom} ${prenom}</div>
            <div style="margin-top:8px"><strong>Avis sur le lieu :</strong><br>${avisLieu||"<em>(vide)</em>"}</div>
            <div style="margin-top:8px"><strong>Avis sur les h√¥tes :</strong><br>${avisH||"<em>(vide)</em>"}</div>
            <div style="margin-top:8px; color:var(--muted)">${date?new Date(date).toLocaleString():''}</div>
          `;
          list.appendChild(el);
        });
      }catch(e){
        list.textContent="Impossible de charger les avis.";
      }
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault(); msg.textContent="Envoi en cours‚Ä¶";
      const payload={
        nom:nom.value.trim(), prenom:prenom.value.trim(), periode:periode.value.trim(),
        noteLieu:noteLieu.value, noteAccueil:noteAccueil.value,
        avisLieu:avisLieu.value.trim(), avisHotes:avisHotes.value.trim(),
        telephone:telephone.value.trim(), ameliorations:ameliorations.value.trim()
      };
      try{
        const r=await fetch(API,{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload)});
        const data=await r.json().catch(()=>({ok:false}));
        if(data.ok){ msg.textContent="‚úÖ Merci ! Votre avis a √©t√© enregistr√©."; form.reset(); await load(); }
        else{ msg.textContent="Erreur lors de l‚Äôenvoi."; }
      }catch(e){ msg.textContent="Erreur r√©seau."; }
    });

    load();
  </script>
</body>
</html>