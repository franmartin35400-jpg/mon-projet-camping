<!DOCTYPE html>
<html lang="fr" data-theme="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Réservations – Camping Rivassland</title>

  <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --glass: rgba(255,255,255,.58);
      --glass-strong: rgba(255,255,255,.70);
      --primary:#2563eb; --primary-700:#1d4ed8; --primary-800:#1e40af;
      --ring:#3b82f6; --text:#0f172a; --muted:#475569; --muted2:#64748b;
      --ok:#16a34a; --warn:#dc2626;
      --shadow: 0 18px 46px rgba(2,6,23,.20);
      --radius:22px;
      --transition:220ms cubic-bezier(.22,.61,.36,1);
    }
    html[data-theme="dark"]{
      --glass: rgba(17,24,39,.48);
      --glass-strong: rgba(17,24,39,.60);
      --primary:#60a5fa; --primary-700:#3b82f6; --primary-800:#1d4ed8;
      --ring:#93c5fd; --text:#e5e7eb; --muted:#cbd5e1; --muted2:#94a3b8;
      --shadow: 0 22px 56px rgba(0,0,0,.46);
    }
    @media (prefers-reduced-motion:no-preference){
      *{ transition: color var(--transition), background-color var(--transition), border-color var(--transition), box-shadow var(--transition), transform var(--transition), opacity var(--transition); }
    }

    /* Fond + vignette */
    html,body{ height:100%; }
    body{ margin:0; color:var(--text); font-family: "Cabin", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body::before, body::after{
      content:""; position:fixed; inset:0; z-index:-4;
      background-size:cover; background-position:center; background-attachment:fixed;
      transition: opacity 900ms ease;
    }
    body::before{ background-image:url("camping.jpg"); opacity:1; }
    body::after { background-image:url("camping-nuit.jpg"); opacity:0; }
    .vignette{ position:fixed; inset:0; z-index:-2; pointer-events:none;
      background: radial-gradient(1200px 800px at 50% 15%, rgba(0,0,0,.22), transparent 60%),
                  linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.10));
      opacity:0; transition: opacity 600ms ease;
    }
    html[data-theme="dark"] body::before{ opacity:0; }
    html[data-theme="dark"] body::after { opacity:1; }
    html[data-theme="dark"] .vignette   { opacity:.32; }

    /* Topbar */
    .topbar{
      position: sticky; top:0; z-index:5;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding: 12px 18px;
      backdrop-filter: blur(8px) saturate(120%);
      background: color-mix(in oklab, rgba(0,0,0,.46) 46%, rgba(255,255,255,.28));
      border-bottom: 1px solid rgba(0,0,0,.20);
      box-shadow: 0 12px 28px rgba(0,0,0,.22);
    }
    html[data-theme="dark"] .topbar{
      background: color-mix(in oklab, rgba(0,0,0,.64) 64%, rgba(255,255,255,.10));
      border-bottom-color: rgba(255,255,255,.14);
      box-shadow: 0 14px 32px rgba(0,0,0,.44);
    }
    .nav-left{ display:flex; align-items:center; gap:16px; }
    .logo{ height:42px; width:auto; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.2); }
    .nav{ display:flex; gap:12px; flex-wrap:wrap; background: color-mix(in oklab, var(--glass) 84%, transparent); border:1px solid rgba(255,255,255,.45); padding:6px 10px; border-radius:999px; }
    .nav a{ text-decoration:none; color:var(--text); font-weight:600; padding:6px 10px; border-radius:999px; }
    .nav a:hover, .nav a[aria-current="page"]{ background: rgba(255,255,255,.38); }

    /* Contenu */
    .wrap{
      max-width: 980px; margin: clamp(12px,4vw,36px) auto; padding: clamp(12px,2.6vw,24px);
      display:grid; gap:16px;
    }
    .panel{
      background: var(--glass); backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: clamp(16px,2.4vw,26px);
      opacity:0; transform: translateY(10px);
    }
    .panel.reveal{ opacity:1; transform:none; transition: opacity .6s ease, transform .6s ease; }
    h1{ margin:0 0 12px; font-size: clamp(26px,3.2vw,36px); font-family: "Poppins", system-ui, sans-serif; letter-spacing:.2px; }
    h2{ margin:0 0 12px; font-size: clamp(18px,2.2vw,24px); color: var(--muted); font-weight: 600; font-family: "Poppins", system-ui, sans-serif; }

    form{ display:grid; grid-template-columns: 1fr 1fr; gap:14px 16px; }
    form label{ font-size:13px; color: var(--muted2); display:flex; flex-direction:column; gap:6px; }
    input, select{
      padding: 12px 14px; border-radius:14px; border:1px solid rgba(15,23,42,.16);
      background:#fff; color:#0f172a;
    }
    html[data-theme="dark"] input, html[data-theme="dark"] select{
      background:#0b1220; color:#e5e7eb; border-color: rgba(148,163,184,.28);
    }
    .row-full{ grid-column:1/-1; }
    .inline{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .hidden{ display:none !important; }

    .ok{ background: color-mix(in oklab, var(--ok) 12%, transparent); border:1px solid color-mix(in oklab, var(--ok) 35%, transparent); color: color-mix(in oklab, var(--ok) 80%, #000); padding:10px 12px; border-radius:12px; }
    .warn{ background: color-mix(in oklab, var(--warn) 12%, transparent); border:1px solid color-mix(in oklab, var(--warn) 35%, transparent); color: color-mix(in oklab, var(--warn) 80%, #000); padding:10px 12px; border-radius:12px; }

    .actions{ grid-column:1/-1; display:flex; gap:10px; flex-wrap:wrap; }
    button{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 18px; border-radius:14px; border:1px solid color-mix(in oklab, var(--primary) 35%, transparent);
      background: linear-gradient(180deg, var(--primary), var(--primary-700)); color:#fff; font-weight:700; cursor:pointer;
      box-shadow: 0 10px 22px color-mix(in oklab, var(--primary) 28%, transparent);
    }
  </style>
</head>
<body>
  <div class="vignette" aria-hidden="true"></div>

  <header class="topbar">
    <div class="nav-left">
      <img src="logo.jpg" alt="Camping Rivassland" class="logo">
      <nav class="nav" aria-label="Navigation principale">
        <a href="accueil.html">Accueil</a>
        <a href="reservation.html" aria-current="page">Réservations</a>
      </nav>
    </div>
    <button id="themeToggle" class="theme-toggle" aria-label="Changer de thème">
      <span id="themeIcon" aria-hidden="true">🌞</span>
      <span id="themeLabel">Mode clair</span>
    </button>
  </header>

  <main class="wrap">
    <section class="panel reveal">
      <h1>Réserver un emplacement</h1>
      <p class="ok">Réservation simple : dites-nous combien vous êtes, pour combien de nuits, et si vous avez besoin d’électricité.</p>
    </section>

    <section class="panel" id="panelForm">
      <h2>Vos informations</h2>
      <form id="resaForm" novalidate>
        <label>Prénom<input id="prenom" required></label>
        <label>Nom<input id="nom" required></label>

        <label>Nombre de personnes
          <input id="nbPersonnes" type="number" min="1" max="8" value="2" required>
        </label>

        <label>Nombre de nuits
          <input id="nbNuits" type="number" min="1" max="30" value="1" required>
        </label>

        <label class="row-full">Besoin d’un accès à l’électricité ?
          <div class="inline">
            <label><input type="radio" name="elec" value="oui" checked> Oui</label>
            <label><input type="radio" name="elec" value="non"> Non</label>
          </div>
        </label>

        <label class="row-full">Venez-vous avec un chien ?
          <div class="inline">
            <label><input type="radio" name="dog" value="non" checked> Non</label>
            <label><input type="radio" name="dog" value="oui"> Oui</label>
          </div>
        </label>

        <!-- Bloc chiens (conditionnel) -->
        <div id="dogBlock" class="row-full hidden">
          <label class="row-full">Votre chien est-il une femelle ?
            <div class="inline">
              <label><input type="radio" name="femelle" value="oui"> Oui</label>
              <label><input type="radio" name="femelle" value="non"> Non</label>
            </div>
          </label>

          <div id="maleBlock" class="row-full hidden">
            <label class="row-full">Si mâle : est-il castré ?
              <div class="inline">
                <label><input type="radio" name="castre" value="oui"> Oui</label>
                <label><input type="radio" name="castre" value="non"> Non</label>
              </div>
            </label>
          </div>

          <p id="dogMsg" class="warn hidden"></p>
        </div>

        <div class="actions">
          <button type="submit" id="btnSubmit">Vérifier & réserver</button>
          <button type="button" id="btnReset">Réinitialiser</button>
        </div>
        <p id="resaMsg" class="row-full" role="status" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <script>
    /* Thème */
    (function themeInit(){
      const html = document.documentElement;
      const saved = localStorage.getItem("theme");
      if (saved === "light" || saved === "dark") html.setAttribute("data-theme", saved);
      else html.setAttribute("data-theme", matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      const btn = document.getElementById("themeToggle");
      const icon = document.getElementById("themeIcon");
      const label = document.getElementById("themeLabel");
      function updateLabel(){ const isDark = html.getAttribute("data-theme")==="dark"; icon.textContent = isDark ? "🌙" : "🌞"; label.textContent = isDark ? "Mode sombre" : "Mode clair"; }
      btn.addEventListener("click", ()=>{ const next = html.getAttribute("data-theme")==="dark" ? "light" : "dark"; html.setAttribute("data-theme", next); localStorage.setItem("theme", next); updateLabel(); });
      updateLabel();
      matchMedia("(prefers-color-scheme: dark)").addEventListener("change", e=>{ if (!localStorage.getItem("theme")){ html.setAttribute("data-theme", e.matches ? "dark" : "light"); updateLabel(); } });
    })();

    /* Reveal des panneaux */
    (function panelsReveal(){
      const items = document.querySelectorAll('.panel');
      const io = new IntersectionObserver((entries)=>{
        let d = 0;
        entries.forEach(e=>{
          if (e.isIntersecting){
            e.target.style.transitionDelay = (d*80)+'ms';
            e.target.classList.add('reveal');
            io.unobserve(e.target);
            d++;
          }
        });
      }, { threshold:.12 });
      items.forEach(el=> io.observe(el));
    })();

    /* Logique chiens + validation */
    (function dogsLogic(){
      const $=s=>document.querySelector(s);
      const dogRadios = document.querySelectorAll('input[name="dog"]');
      const femelleRadios = document.querySelectorAll('input[name="femelle"]');
      const castreRadios = document.querySelectorAll('input[name="castre"]');
      const dogBlock = $('#dogBlock');
      const maleBlock = $('#maleBlock');
      const dogMsg = $('#dogMsg');
      const form = $('#resaForm');
      const resaMsg = $('#resaMsg');
      const btnSubmit = $('#btnSubmit');
      const btnReset  = $('#btnReset');

      function hide(el){ el.classList.add('hidden'); }
      function show(el){ el.classList.remove('hidden'); }
      function resetRadios(nodeList){ nodeList.forEach(r=> r.checked = false); }

      function updateUI(){
        const withDog = [...dogRadios].find(r=>r.checked)?.value === 'oui';
        if (!withDog){
          hide(dogBlock); hide(maleBlock); dogMsg.textContent=''; hide(dogMsg);
          resetRadios(femelleRadios); resetRadios(castreRadios);
          btnSubmit.disabled = false;
          resaMsg.textContent = '';
          return;
        }
        show(dogBlock);
        const isFemelle = [...femelleRadios].find(r=>r.checked)?.value === 'oui';
        const isFemelleSelected = [...femelleRadios].some(r=>r.checked);

        if (!isFemelleSelected){
          hide(maleBlock); dogMsg.textContent=''; hide(dogMsg);
          btnSubmit.disabled = false;
          return;
        }

        if (isFemelle){
          hide(maleBlock);
          dogMsg.textContent = "Parfait, les femelles sont les bienvenues.";
          dogMsg.className = 'ok'; show(dogMsg);
          btnSubmit.disabled = false;
          return;
        }

        // mâle
        show(maleBlock);
        const isCastreSelected = [...castreRadios].some(r=>r.checked);
        const isCastre = [...castreRadios].find(r=>r.checked)?.value === 'oui';

        if (!isCastreSelected){
          dogMsg.textContent=''; hide(dogMsg);
          btnSubmit.disabled = false;
          return;
        }

        if (isCastre){
          dogMsg.textContent = "Très bien, les mâles castrés sont acceptés ✅";
          dogMsg.className = 'ok'; show(dogMsg);
          btnSubmit.disabled = false;
        } else {
          dogMsg.textContent = "Désolés, nous n’acceptons pas les chiens mâles non castrés. Notre propre chien est dominant et n’accepte que les mâles castrés. Merci de votre compréhension 🙏";
          dogMsg.className = 'warn'; show(dogMsg);
          btnSubmit.disabled = true;
        }
      }

      dogRadios.forEach(r=> r.addEventListener('change', updateUI));
      femelleRadios.forEach(r=> r.addEventListener('change', updateUI));
      castreRadios.forEach(r=> r.addEventListener('change', updateUI));

      btnReset.addEventListener('click', ()=>{
        form.reset();
        updateUI();
        resaMsg.textContent = '';
      });

      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        if (btnSubmit.disabled) return; // blocage logique chiens

        const nbPers = Number(document.getElementById('nbPersonnes').value || 0);
        const nbNuits = Number(document.getElementById('nbNuits').value || 0);
        const elec = document.querySelector('input[name="elec"]:checked')?.value === 'oui';

        if (!nbPers || !nbNuits){
          resaMsg.textContent = "Merci de renseigner le nombre de personnes et de nuits.";
          return;
        }

        // Ici on pourrait envoyer vers Google Sheets comme pour le questionnaire.
        // Pour l’instant, on confirme simplement :
        resaMsg.className='ok';
        resaMsg.textContent = `✅ Demande enregistrée : ${nbPers} personne(s) pour ${nbNuits} nuit(s)${elec?' avec électricité':''}. Nous vous recontactons rapidement !`;
        form.reset();
        updateUI();
      });

      updateUI(); // init
    })();
  </script>
</body>
</html>