<!DOCTYPE html>
<html lang="fr" data-theme="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Réservations – Camping Rivassland</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --glass: rgba(255,255,255,.58);
      --glass-strong: rgba(255,255,255,.70);
      --primary:#2563eb; --primary-700:#1d4ed8; --primary-800:#1e40af;
      --text:#0f172a; --muted:#334155; --muted2:#475569;
      --ok:#16a34a; --warn:#dc2626;
      --shadow: 0 18px 46px rgba(2,6,23,.20);
      --radius:22px;
      --transition:220ms cubic-bezier(.22,.61,.36,1);
    }
    html[data-theme="dark"]{
      --glass: rgba(17,24,39,.48);
      --glass-strong: rgba(17,24,39,.60);
      --primary:#60a5fa; --primary-700:#3b82f6; --primary-800:#1d4ed8;
      --text:#e5e7eb; --muted:#cbd5e1; --muted2:#94a3b8;
      --shadow: 0 22px 56px rgba(0,0,0,.46);
    }
    @media (prefers-reduced-motion:no-preference){
      *{ transition: color var(--transition), background-color var(--transition), border-color var(--transition), box-shadow var(--transition), transform var(--transition), opacity var(--transition); }
    }

    html,body{ height:100%; }
    body{ margin:0; color:var(--text); font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.6; }

    /* Fond (haut jour/nuit seulement) */
    body::before, body::after{
      content:""; position:fixed; inset:0; z-index:-4;
      background-image:url("camping.jpg");
      background-size:cover; background-position:center top; background-repeat:no-repeat;
      transition: opacity 900ms ease;
    }
    body::after{ background-image:url("camping-nuit.jpg"); opacity:0; }
    html[data-theme="dark"] body::after{ opacity:1; }

    .vignette{ position:fixed; inset:0; z-index:-2; pointer-events:none;
      background: radial-gradient(1200px 800px at 50% 12%, rgba(0,0,0,.18), transparent 60%);
      opacity:.15;
    }
    html[data-theme="dark"] .vignette{ opacity:.32; }

    /* Topbar */
    .topbar{
      position: sticky; top:0; z-index:5;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding: 12px 18px;
      backdrop-filter: blur(10px) saturate(120%);
      background: color-mix(in oklab, rgba(0,0,0,.50) 50%, rgba(255,255,255,.28));
      border-bottom: 1px solid rgba(0,0,0,.22);
      box-shadow: 0 12px 28px rgba(0,0,0,.22);
    }
    html[data-theme="dark"] .topbar{
      background: color-mix(in oklab, rgba(0,0,0,.66) 66%, rgba(255,255,255,.10));
      border-bottom-color: rgba(255,255,255,.16);
      box-shadow: 0 14px 32px rgba(0,0,0,.44);
    }
    .nav-left{ display:flex; align-items:center; gap:16px; }
    .logo{ height:42px; width:auto; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.2); }
    .nav{ display:flex; gap:10px; flex-wrap:wrap; background: color-mix(in oklab, var(--glass) 84%, transparent); border:1px solid rgba(255,255,255,.45); padding:6px 10px; border-radius:999px; }
    .nav a{ text-decoration:none; color:var(--text); font-weight:600; padding:6px 12px; border-radius:999px; }
    .nav a:hover, .nav a[aria-current="page"]{ background: rgba(255,255,255,.38); }

    /* Contenu */
    .wrap{ max-width: 860px; margin: clamp(12px,4vw,36px) auto; padding: clamp(12px,2.6vw,24px); }
    .panel{
      background: var(--glass); backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255,255,255,.35); border-radius: var(--radius);
      box-shadow: var(--shadow); padding: clamp(18px,3vw,28px);
      opacity:0; transform: translateY(10px);
    }
    .panel.reveal{ opacity:1; transform:none; transition: opacity .6s ease, transform .6s ease; }

    .ok{ background: color-mix(in oklab, var(--ok) 12%, transparent); border:1px solid color-mix(in oklab, var(--ok) 35%, transparent); color: color-mix(in oklab, var(--ok) 80%, #000); padding:10px 12px; border-radius:12px; }
    .warn{ background: color-mix(in oklab, var(--warn) 12%, transparent); border:1px solid color-mix(in oklab, var(--warn) 35%, transparent); color: color-mix(in oklab, var(--warn) 80%, #000); padding:10px 12px; border-radius:12px; }

    h1{ margin:0 0 10px; font-size: clamp(28px,3.2vw,36px); font-family: "Poppins", system-ui, sans-serif; letter-spacing:.2px; }
    p.lead{ color:var(--muted); font-size: 16px; }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 18px; border-radius:14px; border:1px solid color-mix(in oklab, var(--primary) 35%, transparent);
      background: linear-gradient(180deg, var(--primary), var(--primary-700)); color:#fff; font-weight:700; cursor:pointer;
      box-shadow: 0 10px 22px color-mix(in oklab, var(--primary) 28%, transparent);
    }
    button.ghost{ background: transparent; color: var(--text); border:1px dashed color-mix(in oklab, var(--text) 30%, transparent); }

    /* Étapes */
    .step{ display:grid; gap:12px; margin-top:10px; }
    .cols{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 640px){ .cols{ grid-template-columns: 1fr; } }
    label{ font-size:13px; color: var(--muted2); display:flex; flex-direction:column; gap:6px; }
    input, select{ padding: 12px 14px; border-radius:14px; border:1px solid rgba(15,23,42,.16); background:#fff; color:#0f172a; }
    html[data-theme="dark"] input, html[data-theme="dark"] select{ background:#0b1220; color:#e5e7eb; border-color: rgba(148,163,184,.28); }
    small{ color: var(--muted2); }
    .hidden{ display:none !important; }
    .summary{ background: var(--glass-strong); border:1px solid rgba(255,255,255,.4); border-radius:14px; padding:12px 14px; }
  </style>
</head>
<body>
  <div class="vignette" aria-hidden="true"></div>

  <header class="topbar">
    <div class="nav-left">
      <img src="logo.jpg" alt="Camping Rivassland" class="logo">
      <nav class="nav" aria-label="Navigation principale">
        <a href="accueil.html">Accueil</a>
        <a href="reservation.html" aria-current="page">Réservations</a>
      </nav>
    </div>
    <button id="themeToggle" class="theme-toggle" aria-label="Changer de thème">
      <span id="themeIcon" aria-hidden="true">🌞</span>
      <span id="themeLabel">Mode clair</span>
    </button>
  </header>

  <main class="wrap">
    <section class="panel reveal">
      <h1>Réserver un emplacement</h1>
      <p class="ok">Réservation rapide : nous avons simplement besoin de quelques informations pour confirmer votre demande.</p>
      <div class="actions">
        <button id="startWizard">Commencer</button>
      </div>
    </section>

    <section class="panel" id="wizard" aria-live="polite" aria-atomic="true"></section>
  </main>

  <script>
    /* Thème */
    (function themeInit(){
      const html = document.documentElement;
      const saved = localStorage.getItem("theme");
      html.setAttribute("data-theme",
        saved==="light"||saved==="dark" ? saved :
        (matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light")
      );
      const btn = document.getElementById("themeToggle");
      const icon = document.getElementById("themeIcon");
      const label = document.getElementById("themeLabel");
      function updateLabel(){ const isDark = html.getAttribute("data-theme")==="dark"; icon.textContent = isDark ? "🌙" : "🌞"; label.textContent = isDark ? "Mode sombre" : "Mode clair"; }
      btn.addEventListener("click", ()=>{ const next = html.getAttribute("data-theme")==="dark" ? "light" : "dark"; html.setAttribute("data-theme", next); localStorage.setItem("theme", next); updateLabel(); });
      updateLabel();
    })();

    /* Reveal */
    (function panelsReveal(){
      const items = document.querySelectorAll('.panel');
      const io = new IntersectionObserver((entries)=>{
        let d = 0;
        entries.forEach(e=>{
          if (e.isIntersecting){
            e.target.style.transitionDelay = (d*80)+'ms';
            e.target.classList.add('reveal');
            io.unobserve(e.target);
            d++;
          }
        });
      }, { threshold:.12 });
      items.forEach(el=> io.observe(el));
    })();

    /* Assistant de réservation — corrigé */
    (function wizard(){
      const start = document.getElementById('startWizard');
      const wizard = document.getElementById('wizard');
      const state = {
        debut:"", fin:"",
        adultes: 2, enfants: 0,
        vehicule: "Van", electricite: "oui",
        animaux: "non",
        chiens: 0, chiensMaleNonCastre: "non",
        chats: 0, autres: 0
      };
      let step = -1;

      const steps = [ renderDates, renderPeople, renderVehicle, renderAnimals, renderSummary ];

      function mount(){
        wizard.innerHTML = steps[step]();
        bindStepHandlers();
      }

      function bindStepHandlers(){
        // boutons next/back
        const next = wizard.querySelector('[data-next]');
        const back = wizard.querySelector('[data-back]');
        next && next.addEventListener('click', onNext);
        back && back.addEventListener('click', ()=>{ step=Math.max(0, step-1); mount(); });

        // spécifiques animaux (pour basculer zones en live)
        if (step===3){
          const animauxRadios = wizard.querySelectorAll('input[name="animaux"]');
          const chiensInput = wizard.querySelector('#chiens');
          const maleBox = wizard.querySelector('#maleBox');
          const refresh = ()=>{
            const withPets = wizard.querySelector('input[name="animaux"]:checked')?.value==="oui";
            const dogs = Number((wizard.querySelector('#chiens')?.value)||0);
            if (maleBox) maleBox.classList.toggle('hidden', !(withPets && dogs>0));
          };
          animauxRadios.forEach(r=> r.addEventListener('change', refresh));
          chiensInput && chiensInput.addEventListener('input', refresh);
          refresh();
        }
      }

      function onNext(){
        // validation par step
        if (step===0){
          const debut = wizard.querySelector('#debut').value;
          const fin = wizard.querySelector('#fin').value;
          if (!debut || !fin) return toast('Merci de renseigner les deux dates.');
          if (new Date(fin) < new Date(debut)) return toast('La date de fin doit être après la date de début.');
          state.debut=debut; state.fin=fin;
        }
        if (step===1){
          const ad = Number(wizard.querySelector('#adultes').value||0);
          const en = Number(wizard.querySelector('#enfants').value||0);
          if (ad<1) return toast('Au moins 1 adulte.');
          state.adultes=ad; state.enfants=en;
        }
        if (step===2){
          state.vehicule = wizard.querySelector('#vehicule').value;
          state.electricite = wizard.querySelector('input[name="elec"]:checked')?.value || "non";
        }
        if (step===3){
          state.animaux = wizard.querySelector('input[name="animaux"]:checked')?.value || "non";
          if (state.animaux==="oui"){
            state.chiens = Number(wizard.querySelector('#chiens').value||0);
            state.chats  = Number(wizard.querySelector('#chats').value||0);
            state.autres = Number(wizard.querySelector('#autres').value||0);
            // si chiens > 0, on lit la radio maleNonCastre; si non sélectionnée, on suppose "non" par défaut
            const sel = wizard.querySelector('input[name="maleNonCastre"]:checked');
            state.chiensMaleNonCastre = sel ? sel.value : "non";
            if (state.chiens>0 && state.chiensMaleNonCastre==="oui"){
              return toast("Désolés, nous n’acceptons pas les chiens mâles non castrés. Notre propre chien est dominant et n’accepte que les mâles castrés. Merci de votre compréhension 🙏");
            }
          } else {
            state.chiens=0; state.chats=0; state.autres=0; state.chiensMaleNonCastre="non";
          }
        }
        step = Math.min(steps.length-1, step+1);
        mount();
      }

      function toast(msg){
        let n = wizard.querySelector('.warn');
        if (!n){ n=document.createElement('p'); n.className='warn'; wizard.appendChild(n); }
        n.textContent = msg;
      }

      function actions(back=true, nextLabel="Continuer"){
        return `
          <div class="actions">
            ${back?`<button type="button" class="ghost" data-back>Retour</button>`:''}
            <button type="button" data-next>${nextLabel}</button>
          </div>
        `;
      }

      /* Renders */
      function renderDates(){
        return `
          <h2 style="font-family:Poppins; margin:0 0 8px;">Étape 1 · Vos dates</h2>
          <div class="step cols">
            <label>Début du séjour<input type="date" id="debut" value="${state.debut}"></label>
            <label>Fin du séjour<input type="date" id="fin" value="${state.fin}"></label>
            <small>Vous pourrez ajuster ensuite si besoin.</small>
          </div>
          ${actions(false)}
        `;
      }
      function renderPeople(){
        return `
          <h2 style="font-family:Poppins; margin:0 0 8px;">Étape 2 · Voyageurs</h2>
          <div class="step cols">
            <label>Adultes<input type="number" id="adultes" min="1" max="10" value="${state.adultes}"></label>
            <label>Enfants<input type="number" id="enfants" min="0" max="10" value="${state.enfants}"></label>
          </div>
          ${actions(true)}
        `;
      }
      function renderVehicle(){
        return `
          <h2 style="font-family:Poppins; margin:0 0 8px;">Étape 3 · Véhicule</h2>
          <div class="step cols">
            <label>Type de véhicule
              <select id="vehicule">
                ${["Tente","Van","Camping-car","Caravane","Autre"].map(v=>`<option ${state.vehicule===v?"selected":""}>${v}</option>`).join("")}
              </select>
            </label>
            <label>Électricité nécessaire ?
              <div>
                <label><input type="radio" name="elec" value="oui" ${state.electricite==="oui"?"checked":""}> Oui</label>
                <label style="margin-left:12px;"><input type="radio" name="elec" value="non" ${state.electricite==="non"?"checked":""}> Non</label>
              </div>
            </label>
          </div>
          ${actions(true)}
        `;
      }
      function renderAnimals(){
        const petsYes = state.animaux==="oui";
        return `
          <h2 style="font-family:Poppins; margin:0 0 8px;">Étape 4 · Animaux</h2>
          <div class="step">
            <label>Venez-vous avec des animaux ?
              <div>
                <label><input type="radio" name="animaux" value="non" ${!petsYes?"checked":""}> Non</label>
                <label style="margin-left:12px;"><input type="radio" name="animaux" value="oui" ${petsYes?"checked":""}> Oui</label>
              </div>
            </label>

            <div id="petsFields" class="${petsYes?'':'hidden'}" style="margin-top:8px;">
              <div class="cols">
                <label>Chiens (nombre)<input type="number" id="chiens" min="0" max="6" value="${state.chiens}"></label>
                <label>Chats (nombre)<input type="number" id="chats" min="0" max="6" value="${state.chats}"></label>
              </div>

              <div id="maleBox" class="${(state.chiens||0)>0?'':'hidden'}" style="margin-top:6px;">
                <label>Au moins un mâle non castré ?
                  <div>
                    <label><input type="radio" name="maleNonCastre" value="oui" ${state.chiensMaleNonCastre==="oui"?"checked":""}> Oui</label>
                    <label style="margin-left:12px;"><input type="radio" name="maleNonCastre" value="non" ${state.chiensMaleNonCastre==="non"?"checked":""}> Non</label>
                  </div>
                </label>
                <small>Pour la sécurité des animaux, nous n’acceptons pas les mâles non castrés (notre chien est dominant).</small>
              </div>

              <label style="margin-top:6px;">Autres animaux (nombre)<input type="number" id="autres" min="0" max="6" value="${state.autres}"></label>
            </div>
          </div>
          ${actions(true)}
        `;
      }
      function renderSummary(){
        const resume = `
          <ul style="margin:0; padding-left:18px;">
            <li><strong>Dates :</strong> ${state.debut} → ${state.fin}</li>
            <li><strong>Voyageurs :</strong> ${state.adultes} adulte(s)${state.enfants?`, ${state.enfants} enfant(s)`:``}</li>
            <li><strong>Véhicule :</strong> ${state.vehicule}${state.electricite==="oui"?" · électricité":""}</li>
            <li><strong>Animaux :</strong> ${state.animaux==="oui" ? `${state.chiens} chien(s), ${state.chats} chat(s), ${state.autres} autre(s)` : "aucun"}</li>
          </ul>
        `;
        return `
          <h2 style="font-family:Poppins; margin:0 0 8px;">Étape 5 · Récapitulatif</h2>
          <div class="summary">${resume}</div>
          <div class="actions">
            <button type="button" class="ghost" data-back>Retour</button>
            <button type="button" data-next>Envoyer la demande</button>
          </div>
          <p id="finalMsg" class="ok hidden" style="margin-top:10px;"></p>
        `;
      }

      // Start
      start.addEventListener('click', ()=>{
        step = 0;
        mount();
        wizard.scrollIntoView({behavior:'smooth', block:'start'});
      });

      // Dernier envoi → message
      wizard.addEventListener('click', (e)=>{
        const btn = e.target.closest('[data-next]');
        if (!btn) return;
        if (step===steps.length-1){
          const msg = wizard.querySelector('#finalMsg');
          msg.textContent = "✅ Demande envoyée ! Nous vous recontactons rapidement pour confirmer la disponibilité et finaliser la réservation.";
          msg.classList.remove('hidden');
        }
      });
    })();
  </script>
</body>
</html>