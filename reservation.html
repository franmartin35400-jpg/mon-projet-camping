<!DOCTYPE html>
<html lang="fr" data-theme="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R√©servations ‚Äì Camping Rivassland</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --glass:rgba(255,255,255,.62);
      --glass-strong:rgba(255,255,255,.78);
      --primary:#2563eb; --primary-700:#1d4ed8;
      --text:#0b1320;           /* plus noir */
      --muted:#1f2937;          /* plus fonc√© */
      --muted2:#374151;
      --ok:#16a34a; --warn:#dc2626;
      --shadow:0 18px 46px rgba(2,6,23,.20);
      --radius:22px; --transition:220ms cubic-bezier(.2,.8,.2,1);
      --hover-lift: translateY(-3px) scale(1.01);
    }
    html[data-theme="dark"]{
      --glass:rgba(17,24,39,.58);
      --glass-strong:rgba(17,24,39,.70);
      --primary:#60a5fa; --primary-700:#3b82f6;
      --text:#f3f4f6;          /* plus clair */
      --muted:#e5e7eb; --muted2:#cbd5e1;
      --shadow:0 22px 56px rgba(0,0,0,.46);
    }
    @media (prefers-reduced-motion:no-preference){
      *{ transition: color var(--transition), background-color var(--transition), border-color var(--transition), transform var(--transition), box-shadow var(--transition), opacity var(--transition);}
    }
    html,body{height:100%} body{margin:0;color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#000}

    /* Fond resa (avec fallback g√©r√© par JS) */
    .bg, .bg-night{ position:fixed; inset:0; z-index:-1; background-size:cover; background-position:center; background-repeat:no-repeat; }
    .bg-night{ opacity:0 }
    html[data-theme="dark"] .bg{ opacity:0 } html[data-theme="dark"] .bg-night{ opacity:1 }

    /* Topbar (nav centr√©e) */
    .topbar{
      position:sticky; top:0; z-index:5;
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center;
      padding:12px clamp(14px,4vw,22px);
      backdrop-filter:blur(10px) saturate(120%);
      background:color-mix(in oklab, rgba(0,0,0,.55) 55%, rgba(255,255,255,.28));
      border-bottom:1px solid rgba(255,255,255,.2)
    }
    .logo{height:42px;border-radius:10px;justify-self:start}
    .nav{justify-self:center; display:flex;gap:8px;background:color-mix(in oklab,var(--glass) 84%,transparent);border:1px solid rgba(255,255,255,.45);padding:6px 8px;border-radius:999px}
    .nav a{ text-decoration:none; color:var(--text); font-weight:700; padding:6px 12px; border-radius:999px }
    .nav a:hover, .nav a[aria-current="page"]{ background: rgba(255,255,255,.35); transform:translateY(-1px)}
    .theme-toggle{justify-self:end; display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:9px 15px;color:#fff;font-weight:800;border:1px solid color-mix(in oklab,var(--primary) 35%,transparent);background:linear-gradient(180deg,var(--primary),var(--primary-700));cursor:pointer}

    /* Contenu : 2 panneaux mieux structur√©s */
    .wrap{max-width:min(1100px,94vw);margin: clamp(16px,4vw,44px) auto; padding: clamp(12px,2.6vw,24px);
      display:grid; grid-template-columns: .9fr 1.1fr; gap: 18px;}
    @media (max-width: 1000px){ .wrap{ grid-template-columns:1fr } }

    .panel{background:var(--glass);backdrop-filter:blur(10px) saturate(120%);border:1px solid rgba(255,255,255,.45);border-radius:var(--radius);box-shadow:var(--shadow);padding: clamp(18px,3vw,28px)}
    .panel:hover{transform:var(--hover-lift)}
    h1,h2{margin:0 0 12px;font-family:Poppins,system-ui,sans-serif}
    .lead{color:var(--muted2);margin:6px 0 0}
    .divider{height:1px;background:rgba(0,0,0,.08);margin:12px 0}
    .ok{background:color-mix(in oklab,var(--ok) 12%,transparent);border:1px solid color-mix(in oklab,var(--ok) 35%,transparent);color:color-mix(in oklab,var(--ok) 80%,#000);padding:10px 12px;border-radius:12px}
    .warn{background:color-mix(in oklab,var(--warn) 12%,transparent);border:1px solid color-mix(in oklab,var(--warn) 35%,transparent);color:color-mix(in oklab,var(--warn) 80%,#000);padding:10px 12px;border-radius:12px}

    /* Form/wizard */
    .stepper{display:flex;align-items:center;justify-content:center;gap:12px;margin: 0 0 14px;flex-wrap:wrap}
    .stepper .item{display:flex;flex-direction:column;align-items:center;gap:2px;min-width:56px}
    .stepper .dot{--sz:34px;width:var(--sz);height:var(--sz);border-radius:50%;display:grid;place-items:center;font-weight:700;background:rgba(255,255,255,.82);border:1px solid rgba(0,0,0,.08)}
    .stepper .label{font-size:12px;color:var(--muted2);margin-top:4px}
    .stepper .bar{width:38px;height:2px;background:rgba(255,255,255,.75);border-radius:2px}
    .stepper .item.active .dot{background:linear-gradient(180deg,var(--primary),var(--primary-700)); color:#fff}
    .stepper .item.done .dot{background:color-mix(in oklab,var(--ok) 80%,#22c55e); color:#fff}

    .step{display:grid;gap:12px;margin-top:6px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px} @media(max-width:640px){.cols{grid-template-columns:1fr}}
    label{font-size:14px;color:var(--muted);display:flex;flex-direction:column;gap:8px}
    input,select,textarea{padding:12px 14px;border-radius:14px;border:1px solid rgba(15,23,42,.18);background:#fff;color:#0b1320}
    html[data-theme="dark"] input,html[data-theme="dark"] select,html[data-theme="dark"] textarea{background:#0b1220;color:#f3f4f6;border-color:rgba(148,163,184,.32)}
    .summary{background:var(--glass-strong);border:1px solid rgba(255,255,255,.55);border-radius:14px;padding:12px 14px}

    button{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:12px;border:1px solid color-mix(in oklab,var(--primary) 35%,transparent);background:linear-gradient(180deg,var(--primary),var(--primary-700));color:#fff;font-weight:800;cursor:pointer}
    button.ghost{background:transparent;color:var(--text);border:1px dashed color-mix(in oklab,var(--text) 30%,transparent)}
    button:hover{transform:var(--hover-lift)}
    .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}

    /* Overlay refus */
    .overlay{ position:fixed; inset:0; background: rgba(0,0,0,.55); display:none; place-items:center; z-index:10 }
    .overlay .card{ max-width:560px; margin:0 16px; background: var(--glass-strong); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.55); border-radius:18px; padding:22px; box-shadow: var(--shadow); }
  </style>
</head>
<body>
  <div class="bg" id="bgDay" aria-hidden="true"></div>
  <div class="bg-night" id="bgNight" aria-hidden="true"></div>

  <header class="topbar">
    <img src="logo.jpg" alt="Camping Rivassland" class="logo">
    <nav class="nav">
      <a href="accueil.html">Accueil</a>
      <a href="lieu.html">Lieu</a>
      <a href="reservation.html" aria-current="page">R√©servations</a>
      <a href="index.html">Avis</a>
    </nav>
    <button id="themeToggle" class="theme-toggle"><span id="themeIcon">üåû</span><span id="themeLabel">Mode clair</span></button>
  </header>

  <!-- Overlay ‚ÄúAcc√®s refus√©‚Äù -->
  <div id="refuse" class="overlay">
    <div class="card">
      <h2 style="font-family:Poppins;margin:0 0 8px;">Acc√®s refus√©</h2>
      <p class="warn" style="margin:0 0 10px;">
        Nous n‚Äôacceptons pas les chiens <strong>m√¢les non castr√©s</strong>. Notre chien r√©sidant est dominant et nous privil√©gions la s√©curit√© et le confort de tous.
      </p>
      <p class="ok">Vous pouvez revenir en arri√®re pour modifier votre r√©ponse, ou nous contacter pour toute question.</p>
      <div style="display:flex;gap:10px;margin-top:10px">
        <button id="refuseBack" class="ghost">Revenir aux animaux</button>
        <a href="accueil.html" class="theme-toggle" style="text-decoration:none;display:inline-flex;align-items:center">Retour √† l‚Äôaccueil</a>
      </div>
    </div>
  </div>

  <main class="wrap">
    <!-- Panneau 1 : Intro claire et courte -->
    <section class="panel">
      <h1>R√©server un emplacement</h1>
      <p class="lead">R√©servation rapide : dites-nous simplement vos <strong>dates</strong>, le <strong>nombre de personnes</strong>, votre <strong>v√©hicule</strong> et si vous avez des <strong>animaux</strong>.</p>
      <div class="divider"></div>
      <div class="actions"><button id="startWizard">Commencer</button></div>
    </section>

    <!-- Panneau 2 : Wizard clair et a√©r√© -->
    <section class="panel" id="wizard" aria-live="polite" aria-atomic="true">
      <!-- (rempli par JS) -->
    </section>
  </main>

  <script>
    // Th√®me
    (function(){const html=document.documentElement,s=localStorage.getItem("theme");html.setAttribute("data-theme",(s==="light"||"dark"===s)?s:(matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));const b=document.getElementById("themeToggle"),i=document.getElementById("themeIcon"),l=document.getElementById("themeLabel");function u(){const d=html.getAttribute("data-theme")==="dark";i.textContent=d?"üåô":"üåû";l.textContent=d?"Mode sombre":"Mode clair"}b.addEventListener("click",()=>{const n=html.getAttribute("data-theme")==="dark"?"light":"dark";html.setAttribute("data-theme",n);localStorage.setItem("theme",n);u()});u()})();

    // Fonds resa: essaie resa-jour/nuit puis fallback camping.jpg/nuit
    (async function setBackgrounds(){
      const day = document.getElementById('bgDay');
      const night = document.getElementById('bgNight');
      async function canLoad(src){ return new Promise(res=>{ const im=new Image(); im.onload=()=>res(true); im.onerror=()=>res(false); im.src=src+'?v='+Date.now(); });}
      const DAY_PRIMARY='resa-jour.jpg', DAY_FALLBACK='camping.jpg';
      const NIGHT_PRIMARY='resa-nuit.jpg', NIGHT_FALLBACK='camping-nuit.jpg';
      const daySrc   = (await canLoad(DAY_PRIMARY))   ? DAY_PRIMARY   : DAY_FALLBACK;
      const nightSrc = (await canLoad(NIGHT_PRIMARY)) ? NIGHT_PRIMARY : NIGHT_FALLBACK;
      if(day) day.style.backgroundImage = `url("${daySrc}")`;
      if(night) night.style.backgroundImage = `url("${nightSrc}")`;
    })();

    // Wizard
    (function wizard(){
      const start=document.getElementById('startWizard'), root=document.getElementById('wizard');
      const overlay=document.getElementById('refuse'), backBtn=document.getElementById('refuseBack');
      if(!start||!root) return;
      const API="/api/gas?sheet=Reservations";
      const STEP={DATES:0,PEOPLE:1,VEHICLE:2,HAVE_PETS:3,PET_TYPE:4,DOG_SEX:5,DOG_CASTRE:6,OTHER_DETAILS:7,SUMMARY:8};
      const labels=["Dates","Voyageurs","V√©hicule","Animaux","Type","Sexe","Castr√©","D√©tails","R√©cap"];
      const st={debut:"",fin:"",adultes:2,enfants:0,vehicule:"Van",electricite:"oui",animaux:"non",animalType:"",chienSexe:"",chienCastre:"",animauxDetails:""};
      let step=-1;

      function mount(){ root.innerHTML=`${stepper(step)}<div class="fade-in">${view(step)}</div>`; bind(); updateStepper(); }
      function bind(){
        const n=root.querySelector('[data-next]'); const b=root.querySelector('[data-back]');
        if(n) n.addEventListener('click',onNext); if(b) b.addEventListener('click',()=>{step=Math.max(STEP.DATES,step-1); hideRefuse(); mount()});
      }
      function onNext(){
        if(step===STEP.DATES){ const d=root.querySelector('#debut')?.value,f=root.querySelector('#fin')?.value; if(!d||!f) return toast("Dates manquantes"); if(new Date(f)<new Date(d)) return toast("Fin avant d√©but"); st.debut=d;st.fin=f; step=STEP.PEOPLE; return mount(); }
        if(step===STEP.PEOPLE){ const a=+root.querySelector('#adultes').value||0, e=+root.querySelector('#enfants').value||0; if(a<1) return toast("Au moins 1 adulte"); st.adultes=a;st.enfants=e; step=STEP.VEHICLE; return mount(); }
        if(step===STEP.VEHICLE){ st.vehicule=root.querySelector('#vehicule').value; st.electricite=root.querySelector('input[name="elec"]:checked')?.value||"non"; step=STEP.HAVE_PETS; return mount(); }
        if(step===STEP.HAVE_PETS){ st.animaux=root.querySelector('input[name="animaux"]:checked')?.value||"non"; if(st.animaux==="non"){ step=STEP.SUMMARY; return mount(); } step=STEP.PET_TYPE; return mount(); }
        if(step===STEP.PET_TYPE){ st.animalType=root.querySelector('input[name="animalType"]:checked')?.value||""; if(!st.animalType) return toast("Choisissez le type"); if(st.animalType==="chien"){ step=STEP.DOG_SEX; } else { step=STEP.OTHER_DETAILS; } return mount(); }
        if(step===STEP.DOG_SEX){ st.chienSexe=root.querySelector('input[name="chienSexe"]:checked')?.value||""; if(!st.chienSexe) return toast("Sexe du chien"); if(st.chienSexe==="male"){ step=STEP.DOG_CASTRE; } else { step=STEP.SUMMARY; } return mount(); }
        if(step===STEP.DOG_CASTRE){
          st.chienCastre=root.querySelector('input[name="chienCastre"]:checked')?.value||"";
          if(!st.chienCastre) return toast("Castration ?");
          if(st.chienCastre==="non"){ showRefuse(); return; } // √©cran refus
          step=STEP.SUMMARY; return mount();
        }
        if(step===STEP.OTHER_DETAILS){ st.animauxDetails=(root.querySelector('#animauxDetails')?.value||"").trim(); if(!st.animauxDetails) return toast("Pr√©cisez l‚Äôanimal"); step=STEP.SUMMARY; return mount(); }
        if(step===STEP.SUMMARY){ submit().catch(e=>toast("Erreur d‚Äôenvoi")); }
      }

      function showRefuse(){ overlay.style.display="grid"; }
      function hideRefuse(){ overlay.style.display="none"; }
      backBtn.addEventListener('click', ()=>{ hideRefuse(); step=STEP.DOG_CASTRE; mount(); });

      function toast(t){ let n=root.querySelector('.warn'); if(!n){n=document.createElement('p');n.className='warn';root.appendChild(n);} n.textContent=t; }

      function stepper(s){ return `<div class="stepper">${labels.map((lab,i)=>`
          <div class="item ${i<s?'done':i===s?'active':''}">
            <div class="dot">${i<s?'‚úîÔ∏é':i+1}</div>
            <div class="label">${lab}</div>
          </div>`).join(`<div class="bar"></div>`)}</div>`; }

      function actions(back=true,next="Continuer"){ return `<div class="actions">${back?`<button class="ghost" data-back>Retour</button>`:""}<button data-next>${next}</button></div>`; }

      function view(s){
        if(s===STEP.DATES) return `<h2>√âtape 1 ¬∑ Vos dates</h2>
          <div class="step cols"><label>D√©but<input type="date" id="debut" value="${st.debut}"></label><label>Fin<input type="date" id="fin" value="${st.fin}"></label></div>${actions(false)}`;
        if(s===STEP.PEOPLE) return `<h2>√âtape 2 ¬∑ Voyageurs</h2>
          <div class="step cols"><label>Adultes<input type="number" id="adultes" min="1" value="${st.adultes}"></label><label>Enfants<input type="number" id="enfants" min="0" value="${st.enfants}"></label></div>${actions(true)}`;
        if(s===STEP.VEHICLE) return `<h2>√âtape 3 ¬∑ V√©hicule</h2>
          <div class="step cols">
            <label>Type<select id="vehicule">${["Tente","Van","Camping-car","Caravane","Autre"].map(v=>`<option ${st.vehicule===v?"selected":""}>${v}</option>`).join("")}</select></label>
            <label>√âlectricit√© ?<div><label><input type="radio" name="elec" value="oui" ${st.electricite==="oui"?"checked":""}> Oui</label><label style="margin-left:12px"><input type="radio" name="elec" value="non" ${st.electricite==="non"?"checked":""}> Non</label></div></label>
          </div>${actions(true)}`;
        if(s===STEP.HAVE_PETS) return `<h2>√âtape 4 ¬∑ Animaux</h2>
          <div class="step"><label>Venez-vous avec des animaux ?
            <div><label><input type="radio" name="animaux" value="non" ${st.animaux==="non"?"checked":""}> Non</label>
            <label style="margin-left:12px"><input type="radio" name="animaux" value="oui" ${st.animaux==="oui"?"checked":""}> Oui</label></div>
          </label></div>${actions(true,"Continuer")}`;
        if(s===STEP.PET_TYPE) return `<h2>√âtape 5 ¬∑ Type d‚Äôanimal</h2>
          <div class="step"><label>Quel type ?
            <div><label><input type="radio" name="animalType" value="chien" ${st.animalType==="chien"?"checked":""}> Chien</label>
            <label style="margin-left:12px"><input type="radio" name="animalType" value="autre" ${st.animalType==="autre"?"checked":""}> Autre</label></div>
          </label></div>${actions(true)}`;
        if(s===STEP.DOG_SEX) return `<h2>√âtape 6 ¬∑ Sexe du chien</h2>
          <div class="step"><div><label>
            <div><label><input type="radio" name="chienSexe" value="male" ${st.chienSexe==="male"?"checked":""}> M√¢le</label>
            <label style="margin-left:12px"><input type="radio" name="chienSexe" value="femelle" ${st.chienSexe==="femelle"?"checked":""}> Femelle</label></div>
          </label></div><small>Si m√¢le ‚Üí question suivante.</small></div>${actions(true)}`;
        if(s===STEP.DOG_CASTRE) return `<h2>√âtape 7 ¬∑ Castration</h2>
          <div class="step"><label>Votre chien m√¢le est-il castr√© ?
            <div><label><input type="radio" name="chienCastre" value="oui" ${st.chienCastre==="oui"?"checked":""}> Oui</label>
            <label style="margin-left:12px"><input type="radio" name="chienCastre" value="non" ${st.chienCastre==="non"?"checked":""}> Non</label></div>
          </label><small>Par s√©curit√©, nous n‚Äôacceptons pas les m√¢les non castr√©s.</small></div>${actions(true)}`;
        if(s===STEP.OTHER_DETAILS) return `<h2>√âtape 6 ¬∑ D√©tails des animaux</h2>
          <div class="step"><label>Pr√©cisions<textarea id="animauxDetails" rows="3" placeholder="Ex. 1 chat st√©rilis√©, 2 lapins‚Ä¶">${st.animauxDetails||""}</textarea></label></div>${actions(true)}`;
        if(s===STEP.SUMMARY){
          const animauxTxt=(st.animaux==="non")?"aucun":(st.animalType==="chien"?`chien (${st.chienSexe}${st.chienSexe==="male"?(st.chienCastre==="oui"?", castr√©":", non castr√©"):""})`:`autre : ${st.animauxDetails||"non pr√©cis√©"}`);
          return `<h2>√âtape 8 ¬∑ R√©capitulatif</h2>
            <div class="summary">
              <ul style="margin:0;padding-left:18px">
                <li><strong>Dates :</strong> ${st.debut} ‚Üí ${st.fin}</li>
                <li><strong>Voyageurs :</strong> ${st.adultes} adulte(s)${st.enfants?`, ${st.enfants} enfant(s)`:``}</li>
                <li><strong>V√©hicule :</strong> ${st.vehicule}${st.electricite==="oui"?" ¬∑ √©lectricit√©":""}</li>
                <li><strong>Animaux :</strong> ${animauxTxt}</li>
              </ul>
            </div>
            <div class="actions"><button class="ghost" data-back>Retour</button><button data-next>Envoyer la demande</button></div>
            <p id="finalMsg" class="ok" style="display:none;margin-top:10px"></p>`;
        }
        return "";
      }
      function updateStepper(){
        const nodes=root.querySelectorAll('.stepper .item');
        nodes.forEach((n,i)=>{ n.classList.toggle('active',i===step); n.classList.toggle('done',i<step); const d=n.querySelector('.dot'); if(d) d.textContent=i<step?"‚úîÔ∏é":String(i+1); });
      }
      function stepper(s){ return `<div class="stepper">${labels.map((lab,i)=>`
          <div class="item ${i<s?'done':i===s?'active':''}">
            <div class="dot">${i<s?'‚úîÔ∏é':i+1}</div>
            <div class="label">${lab}</div>
          </div>`).join(`<div class="bar"></div>`)}</div>`; }
      function actions(back=true,next="Continuer"){ return `<div class="actions">${back?`<button class="ghost" data-back>Retour</button>`:""}<button data-next>${next}</button></div>`; }
      async function submit(){
        const payload={debut:st.debut,fin:st.fin,adultes:String(st.adultes),enfants:String(st.enfants),vehicule:st.vehicule,electricite:st.electricite,animaux:st.animaux,animalType:st.animalType,chienSexe:st.chienSexe,chienCastre:st.chienCastre,animauxDetails:st.animauxDetails};
        const r=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
        const data=await r.json().catch(()=>({ok:false}));
        const m=document.getElementById('finalMsg'); if(!m) return;
        if(data.ok){ m.style.display="block"; m.textContent="‚úÖ Demande envoy√©e ! Nous vous recontactons rapidement."; }
        else { m.style.display="block"; m.className="warn"; m.textContent="Erreur d‚Äôenvoi."; }
      }

      start.addEventListener('click', ()=>{ step=STEP.DATES; mount(); root.scrollIntoView({behavior:'smooth',block:'start'}); });
      root.addEventListener('click', (e)=>{ if(e.target.closest && e.target.closest('[data-next]') && step===STEP.SUMMARY){ submit(); } });
    })();
  </script>
</body>
</html>